# å¤§é‡ä»»åŠ¡æ‰§è¡Œçš„è°ƒåº¦

ğŸ‘‰ åœ¨å¼‚æ­¥ä»»åŠ¡æœ‰ä½¿ç”¨åˆ° `await` å…³é”®å­—çš„åœ°æ–¹éƒ½éœ€è¦åŒ…è£¹å®ƒçš„å‡½æ•°å£°æ˜æˆ `async`

```javascript
function _runTask(task) {
  // requestIdleCallback ç”¨äºè·å–å½“å‰å¸§æ˜¯å¦æœ‰ç©ºé—²æ—¶é—´
  requestIdleCallback((idle) => {
    // åˆ¤æ–­å½“å‰å¸§æ˜¯å¦è¿˜æœ‰ç©ºé—²æ—¶é—´ï¼Œæœ‰åˆ™æ‰§è¡Œä»»åŠ¡
    if (idle.timeRemaining() > 0) {
      task();
    } else {
      // æ²¡æœ‰ï¼Œåˆ™æ¨è¿Ÿæ‰§è¡Œä»»åŠ¡
      _runTask(task);
    }
  });
}

function _runTaskPollyfill(task) {
  const start = performance.now();
  requestAnimationFrame(() => {
    if (performance.now() - start < 16.6) {
      task();
    } else {
      _runTaskPollyfill(task);
    }
  });
}

function runTask(task) {
  // æ–¹æ¡ˆ1ï¼šåŒæ­¥çš„æ–¹å¼ç›´æ¥æ‰§è¡Œ task --> é˜»å¡
  // task();
  // æ–¹æ¡ˆ2ï¼šæŠŠä»»åŠ¡æ”¾åˆ°å¾®é˜Ÿåˆ—é‡Œå»æ‰§è¡Œ --> é˜»å¡
  // Promise.resolve().then(task);
  // æ–¹æ¡ˆ3ï¼šæŠŠä»»åŠ¡æ”¾åˆ°å®ä»»åŠ¡å»æ‰§è¡Œ --> å¡é¡¿
  // setTimeout(task);
  // æ–¹æ¡ˆ4ï¼šç›´æ¥ä½¿ç”¨raf --> é˜»å¡
  // requestAnimationFrame(task);
  // æ–¹æ¡ˆ5ï¼šidle --> æµç•…ï¼Œæœ‰å…¼å®¹æ€§é—®é¢˜ï¼ˆsafariæµè§ˆå™¨ä¸æ”¯æŒï¼‰
  // _runTask(task);
  // æ–¹æ¡ˆ6ï¼šraf+æ§åˆ¶ --> æµç•…ï¼Œè§£å†³å…¼å®¹æ€§é—®é¢˜
  _runTaskPollyfill(task);
  // æ–¹æ¡ˆ7ï¼šweb worker
}
```
